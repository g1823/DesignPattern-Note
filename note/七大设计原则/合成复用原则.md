## 合成复用原则

### 1.基本介绍

​     合成复用原则又叫组合/聚合复用原则。它要求在软件复用时，要尽量先使用组合或者聚合等关联关系来实现，其次才考虑使用继承关系来实现。

​     如果要使用继承关系，则必须严格遵循里氏替换原则。合成复用原则同里氏替换原则相辅相成的，两者都是开闭原则的具体实现规范。



**好处：**

1. 合成关系比继承关系更加灵活。通过合成关系，一个类可以通过包含其他类的对象来重用其他类的功能，而不需要继承其接口和实现。这种组合关系使得类之间的耦合度降低，系统更加灵活。
2. 避免继承链的臃肿：继承关系的问题之一是继承链可能变得非常庞大和复杂。当继承链过长时，任何一个基类的修改都会对整个继承链产生影响，导致代码的可维护性下降。而通过合成关系，可以将功能分散到不同的类中，避免了继承链的问题。
3. 提高系统的灵活性：通过合成关系，可以动态地在运行时更改对象之间的关系。这使得系统更加灵活，可以根据需要组装和调整对象之间的关系，以适应不同的需求和变化。
4. 降低类之间的耦合性：通过合成关系，类之间的耦合度降低。对象之间仅通过接口进行交互，而不依赖于具体的实现细节。这样可以减少代码之间的依赖关系，提高代码的可维护性和可复用性。

### 2.应用实例

​      做一个图形绘制系统。

#### 初始设计

​	假设我们有一个简化的图形绘制系统，其中有一个Shape基类和两个子类Rectangle和Circle，分别表示矩形和圆形。

初始设计中，Rectangle和Circle继承自Shape类。

```java
class Shape{
	//公共的图形绘制逻辑
	public void draw(){
    //绘制图形的具体实现
  }
}
class Rectangle extends Shape{
  //矩形特有的逻辑和属性
}

class Circle extends Shape{
  //圆形特有的逻辑和属性
}
```

**新需求：**

​	这个设计在一开始可能看起来很合理，但随着业务的发展，可能会引发一些问题。

​	假设现在要添加一个新的需求，要求绘制的形状既可以填充颜色，又可以绘制边框。



#### 方案一：

​	按初始的继承关系，我们可能会修改Rectangle和Circle的代码，将填充颜色和绘制边框的逻辑添加到这两个子类中。

**问题：**

​      种修改违反了合成复用原则，导致Rectangle和Circle的实现中包含了与填充颜色和绘制边框相关的代码，使得这两个子类与这些功能紧密耦合在一起。这种设计不仅增加了代码的复杂性，而且在添加新的功能时需要修改多个子类，违反了开闭原则。

**源码：**

~~~ java
class Rectangle extends Shape{
	// 矩形特有的逻辑和属性
	public void draw(){
    // 绘制矩形的逻辑
		// 绘制填充颜色的逻辑
		// 绘制边框的逻辑
  }

class Circle extends Shape{
  // 圆形特有的逻辑和属性
	public void draw(){
    // 绘制圆形的逻辑
		// 绘制填充颜色的逻辑
		// 绘制边框的逻辑
  }
}
~~~

#### 方案二：

​      使用合成复用原则，通过对象组合来实现代码复用。我们可以创建一个新的Color类和Border类，用于表示填充颜色和边框，并将其作为Shape类的成员变量。

​      通过这种改进，我们将填充颜色和绘制边框的逻辑从子类中移除，并将其封装到了独立的类中。

​      现在，任何形状的子类都可以通过setFillColor和setBorder方法来设置填充颜色和边框，并且绘制的逻辑被统一封装在Shape类中。

​      这样，我们可以在不修改子类的情况下，轻松地添加新的功能或修改现有功能，遵循了开闭原则和合成复用原则。

**源码：**

~~~ java
class Shape{
  private Color fillColor:
	private Border border;
  // 设置填充颜色
	public void setFiliColor(Color color){
    this.fillcolor =color;
  }
	// 设置边框
	public void setBorder(Border border){
    this.border = border;
  }
	// //公共的图形绘制逻辑
	public void draw(){
    // 绘制图形的具体实现
		// 使用fillColor和 border进行填充和绘制边框的逻辑
  }
}

class Color{
  // 颜色的属性和方法
}

class Border{
  // 边框的属性和方法
}
~~~



